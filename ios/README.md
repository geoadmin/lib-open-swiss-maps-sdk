<h1 align="center">OpenSwissMapsSDK</h1>

<br />

<div align="center">
    <!-- SPM -->
    <a href="https://github.com/apple/swift-package-manager">
      <img alt="Swift Package Manager"
      src="https://img.shields.io/badge/SPM-%E2%9C%93-brightgreen.svg?style=flat">
    </a>
    <!-- License -->
    <a href="https://github.com/geoadmin/lib-open-swiss-maps-sdk/blob/master/LICENSE">
      <img alt="TODO" src="TODO">
    </a>
    <!-- iOS Build -->
    <a href="https://github.com/geoadmin/lib-open-swiss-maps-sdk/actions/workflows/ios.yml">
      <img alt="Build status: iOS"
      src="https://github.com/geoadmin/lib-open-swiss-maps-sdk/actions/workflows/ios.yml/badge.svg">
    </a>
    <!-- android Build -->
    <a href="https://github.com/geoadmin/lib-open-swiss-maps-sdk/actions/workflows/android.yml">
      <img alt="Build status: android"
      src="https://github.com/geoadmin/lib-open-swiss-maps-sdk/actions/workflows/android.yml/badge.svg">
    </a>
</div>

# iOS

## Installation

Open Mobile Maps is available through [Swift Package Manager](https://swift.org/package-manager/).

### Xcode

For App integration within XCode, add this package to your App target. To do this, follow the step by step tutorial [Adding Package Dependencies to Your App](https://developer.apple.com/documentation/xcode/adding_package_dependencies_to_your_app).

### Swift Package

Once you have your Swift package set up, adding Open Mobile Maps as a dependency is as easy as adding it to the dependencies value of your Package.swift.

```swift
dependencies: [
    .package(url: "https://github.com/geoadmin/lib-open-swiss-maps-sdk.git", .upToNextMajor(from: "1.0.0"))
]
```

### iOS 10

Unfortunately, Swift package is only supported starting with iOS 11. If you need iOS 10 support you have to compile the library as a framework yourself.

## How To use

##### Display Swisstopo Map in a ViewController

The SDK provides a the view SwisstopoMapView which is a UIView subclass. By default the `ch.swisstopo.pixelkarte-farbe`layer is displayed.

```swift
import UIKit
import SwisstopoMapSDK

class MapViewController: UIViewController {
  lazy var mapView = SwisstopoMapView()
  override func loadView() {
    view = mapView
  }
}
```

##### Initializing the view with a different baselayer type

```swift
lazy var mapView = SwisstopoMapView(baseLayerType: .SWISSIMAGE)
```

##### Changing the baselayer type after initializing the view

```swift
mapView.setBaseLayerType(type: .PIXELKARTE_GRAUSTUFEN)
```

##### Adding multiple layer 

```swift
let drohnenLayer = mapView.addSwisstopoLayer(type: .DROHNEN)
drohnenLayer.setAlpha(0.25)
```

##### Adjusting the camera

The camera position can easily be adjusted by manipulating the Camera2dInterface received from the map. E.g. to set a custom location:

```swift
mapView.camera.move(toCenterPosition: .init(systemIdentifier: MCCoordinateSystemIdentifiers.epsg4326(),
                                                x: 8.378232525377973,
                                                y: 46.962592372639634,
                                                z: 0), animated: true)
```

##### Reacting to clicks on a layer

```swift
import UIKit
import SwisstopoMapSDK
import MapCoreSharedModule

class MapViewController: UIViewController {
  lazy var mapView = SwisstopoMapView(baseLayerType: .SWISSIMAGE)
  
  override func loadView() {
    view = mapView
  }
  
  override func viewDidLoad() {
    super.viewDidLoad()
    mapView.baseLayer.setCallbackHandler(self)
  }
}

extension MapViewController: MCTiled2dMapRasterLayerCallbackInterface {
  func onClickConfirmed(_ coord: MCCoord) -> Bool {
    // react to click
    // return true if interaction was consumend
    return true
  }
  func onLongPress(_ coord: MCCoord) -> Bool {
    // react to longpress
    // return true if interaction was consumend
    return true
  }
}
```

## How to build

If you'd like to build Open Mobile Maps yourself, make sure you have all submodules initialized and updated. To do this, use

```shell
git submodule init
git submodule update
```

### Updating Djinni bridging files

The bridging interface between Kotlin and C++ are defined in the djinni files under [djinni](../djinni). After modifying those files, the new bridging code can be generated by running

```make clean djinni```

in the folder [djinni](../djinni). This generates the Kotlin bindings, the C++ header files as well as all the Objective C glue code.

### Building the iOS Package.

The [Package.swift](../Package.swift) file can be opened in Xcode and build directly from there. 